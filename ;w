require_relative 'farkle.rb'
require_relative 'dice.rb'
require_relative 'player.rb'
require_relative 'asides.rb'
require_relative 'yesorno.rb'

class Max
  def max_score(players)
    max = 0
    players.each do |player|
      if player.score > max
        max = player.score
      end
    end
    max
  end
end
  max = Max.new
  ans = YesOrNo.new
  # Ask if user wants to play
  puts "Would you like to start a game? (y/n)"

  # play until user wants to stop
  while (ans.yes?)

    # new farkle object to call Farkle class methods
    players = []

    puts "Enter the number of players: "
    num_players = gets.to_i
    i = 0
    while (i < num_players)
      puts "Enter the name of player #{(i+1).to_s}: "
      players << Player.new(gets.chomp)
      i += 1
    end

    # placeholder to output score of each turn
    current_score = 0

    # array to set aside dice each turn

    # loop until a user has won (gets over 10000 points)
    while (max.max_score(players) < 10000)
      players.each do |player|
        puts "It is now #{player.name}'s turn"

        roll = Dice.new
        asides = Asides.new
        score = Score.new

        roll.show_dice
        score.score_dice(roll.dice)
        score.show_score

        while roll.has_points?
          asides.show_asides if asides.has_asides?
          puts "Would you like to set aside, or cash out your points?"
          if ans.yes?
            asides.set_aside(roll.dice)
          else
            break
          end
          roll.roll(1 - asides.asides.length)
          score.score_dice(roll.dice)
          score.show_score
        end
        player.score += score.score
      end
    end



      # call start_turn to start the user's turn.
      # Returns the score of each turn
      current_score = farkle.start_turn(player, 6, scores, asides) 

      # Outpus the score of the turn
      puts "You scored #{current_score} points this round"

      # Add the score to the running total of the player
      scores[player-1] += current_score

      # switch players
      player = farkle.switch_player(player)
      
      # reset the asides each turn
      asides = []
  end

  # switch players because the players switch after a player has won
  player = farkle.switch_player(player)
  puts "Player #{player.to_s} wins with a score of #{scores[player-1]}!"

  # ask if user would like another game
  puts "Would you like to play a new game? (y/n)"
  play = gets.chomp
puts "Thanks for playing! I hope you enjoyed"
